#!/bin/sh

pane_path="${1:-$HOME}"

# A different popup per session
session="_popup_$(tmux display -p '#S')"

if ! tmux has -t "$session" 2>/dev/null; then
    # Save parent session in case I want to detach the popup window and assign it to the parent
    parent_session="$(tmux display -p '#{session_id}')"
    session_id="$(tmux new-session -dP -s "$session" -c "$pane_path" -e TMUX_PARENT_SESSION="$parent_session" -F '#{session_id}')"

    tmux set-option -s -t "$session_id" key-table popup
    tmux set-option -s -t "$session_id" prefix None
    tmux set-option -s -t "$session_id" detach-on-destroy on 2>/dev/null || true
    tmux set-option -s -t "$session_id" status off

    session="$session_id"
fi

exec tmux attach -t "$session" >/dev/null
