#!/usr/bin/env bash

files=()
while read -r line; do
    p="${line/\~/$HOME}"
    if [[ -f "$p" ]] && file "$p" | grep -q 'text'; then
        files+=("$p")
    fi
done < <(tmux show-buffer | xargs | tr ' ' '\n' | grep -v 'tmux_fzf_search_files' | sort | uniq)

if ! choice="$(echo "${files[@]}" | xargs | tr ' ' '\n' | sort | uniq | sort -r | fzf)"; then
    exit 0
fi

p="${choice/\~/$HOME}"
if [[ -e "$p" ]]; then
    nvim "$p"
fi
